# MiSub D1 æ•°æ®åº“é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä¸º MiSub ç³»ç»Ÿé…ç½® Cloudflare D1 æ•°æ®åº“ï¼Œä»¥è§£å†³ KV å­˜å‚¨çš„å†™å…¥é™åˆ¶é—®é¢˜ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»º D1 æ•°æ®åº“

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åˆ›å»º D1 æ•°æ®åº“
wrangler d1 create misub-database
```

å‘½ä»¤æ‰§è¡Œåï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š
```
âœ… Successfully created DB 'misub-database' in region APAC
Created your database using D1's new storage backend. The new storage backend is not yet recommended for production workloads, but backs up your data via point-in-time restore.

[[d1_databases]]
binding = "MISUB_DB"
database_name = "misub-database"
database_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
```

### 2. æ›´æ–° wrangler.toml é…ç½®

å°†ä¸Šä¸€æ­¥è¾“å‡ºçš„æ•°æ®åº“ ID å¤åˆ¶åˆ° `wrangler.toml` æ–‡ä»¶ä¸­ï¼š

```toml
[[d1_databases]]
binding = "MISUB_DB"
database_name = "misub-database"
database_id = "your-actual-database-id-here"  # æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®åº“ ID
preview_database_id = "your-actual-database-id-here"  # åŒæ ·æ›¿æ¢ä¸ºå®é™…çš„æ•°æ®åº“ ID
```

### 3. åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„

```bash
# æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
wrangler d1 execute misub-database --file=schema.sql
```

### 4. éƒ¨ç½²åº”ç”¨

```bash
# æ„å»ºå¹¶éƒ¨ç½²
npm run build
wrangler pages deploy
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åœ¨è®¾ç½®ä¸­åˆ‡æ¢å­˜å‚¨ç±»å‹

1. ç™»å½• MiSub ç®¡ç†ç•Œé¢
2. æ‰“å¼€"è®¾ç½®"é¡µé¢
3. åœ¨"æ•°æ®å­˜å‚¨ç±»å‹"éƒ¨åˆ†é€‰æ‹©"D1 æ•°æ®åº“"
4. ç‚¹å‡»"ä¿å­˜è®¾ç½®"

### æ•°æ®è¿ç§»

å¦‚æœæ‚¨å·²ç»æœ‰ KV ä¸­çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„è¿ç§»åŠŸèƒ½ï¼š

1. åœ¨è®¾ç½®é¡µé¢ä¸­ï¼Œå½“å­˜å‚¨ç±»å‹ä¸º"KV å­˜å‚¨"æ—¶
2. ç‚¹å‡»"ğŸš€ è¿ç§»æ•°æ®åˆ° D1 æ•°æ®åº“"æŒ‰é’®
3. ç¡®è®¤è¿ç§»æ“ä½œ
4. ç­‰å¾…è¿ç§»å®Œæˆ
5. ç³»ç»Ÿä¼šè‡ªåŠ¨å°†å­˜å‚¨ç±»å‹åˆ‡æ¢ä¸º"D1 æ•°æ®åº“"

## ğŸ“Š å­˜å‚¨ç±»å‹å¯¹æ¯”

| ç‰¹æ€§ | KV å­˜å‚¨ | D1 æ•°æ®åº“ |
|------|---------|-----------|
| å†™å…¥é™åˆ¶ | æœ‰é™åˆ¶ | æ— é™åˆ¶ |
| æŸ¥è¯¢é€Ÿåº¦ | æå¿« | å¿« |
| æ•°æ®ç»“æ„ | é”®å€¼å¯¹ | å…³ç³»å‹ |
| æˆæœ¬ | è¾ƒä½ | ä¸­ç­‰ |
| é€‚ç”¨åœºæ™¯ | è¯»å¤šå†™å°‘ | é¢‘ç¹æ›´æ–° |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è¿ç§»æ˜¯å•å‘çš„**ï¼šä» KV è¿ç§»åˆ° D1 åï¼Œå»ºè®®ä¸è¦å†åˆ‡æ¢å› KV
2. **æ€§èƒ½å·®å¼‚**ï¼šD1 æŸ¥è¯¢å¯èƒ½æ¯” KV ç¨æ…¢ï¼Œä½†å†™å…¥æ— é™åˆ¶
3. **æˆæœ¬è€ƒè™‘**ï¼šD1 æœ‰ä¸åŒçš„è®¡è´¹æ¨¡å¼ï¼Œè¯·æŸ¥çœ‹ Cloudflare å®šä»·
4. **å¤‡ä»½å»ºè®®**ï¼šè¿ç§»å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: åˆ›å»ºæ•°æ®åº“æ—¶æç¤ºæƒé™é”™è¯¯**
A: ç¡®ä¿æ‚¨å·²ç™»å½• Cloudflare è´¦æˆ·ï¼š`wrangler auth login`

**Q: éƒ¨ç½²åæ— æ³•è®¿é—® D1 æ•°æ®åº“**
A: æ£€æŸ¥ `wrangler.toml` ä¸­çš„æ•°æ®åº“ ID æ˜¯å¦æ­£ç¡®

**Q: è¿ç§»å¤±è´¥**
A: æ£€æŸ¥ D1 æ•°æ®åº“æ˜¯å¦æ­£ç¡®é…ç½®ï¼Œå¹¶æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

**Q: åˆ‡æ¢å­˜å‚¨ç±»å‹åæ•°æ®ä¸¢å¤±**
A: ä¸åŒå­˜å‚¨ç±»å‹çš„æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ‡æ¢å‰è¯·å…ˆè¿›è¡Œæ•°æ®è¿ç§»

### éªŒè¯é…ç½®

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ D1 æ•°æ®åº“é…ç½®ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰ D1 æ•°æ®åº“
wrangler d1 list

# æŸ¥è¯¢æ•°æ®åº“è¡¨
wrangler d1 execute misub-database --command="SELECT name FROM sqlite_master WHERE type='table';"
```

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥ Cloudflare Workers æ§åˆ¶å°çš„æ—¥å¿—
2. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ç½‘ç»œå’Œæ§åˆ¶å°é€‰é¡¹å¡
3. ç¡®è®¤ wrangler.toml é…ç½®æ­£ç¡®
4. éªŒè¯æ•°æ®åº“è¡¨å·²æ­£ç¡®åˆ›å»º

---

é…ç½®å®Œæˆåï¼Œæ‚¨çš„ MiSub ç³»ç»Ÿå°†èƒ½å¤Ÿä½¿ç”¨ D1 æ•°æ®åº“ï¼Œæœ‰æ•ˆè§£å†³ KV å†™å…¥é™åˆ¶çš„é—®é¢˜ï¼
